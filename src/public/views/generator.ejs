<%- include('partials/header', { title: 'Generator' }) %>
<div class="carousel-container">
  <div class="carousel-slide"></div>
</div>
<div id="processingProgressBarWrapper" class="processing-progress-wrapper">
  <div class="processing-progress-track">
    <div id="processingProgressBar" class="processing-progress-bar"></div>
    <div id="processingProgressLabel" class="processing-progress-label">Idle</div>
  </div>
</div>
<form id="uploadForm" enctype="multipart/form-data" data-max-upload-files="<%= typeof maxUploadFiles !== 'undefined' ? maxUploadFiles : 12 %>">
  <div class="main-container">
    <div class="main-col">
        <div class="main-section upload-section">
        <h2>Image Input</h2>
        <div id="dropArea" class="drop-area image-box">
          <p id="dropText" class="placeholder">Drag & drop or click to upload (up to <%= typeof maxUploadFiles !== 'undefined' ? maxUploadFiles : 12 %> images)</p>
          <div id="multiPreviewContainer" class="multi-preview-container" style="display:none;"></div>
          <input id="inputImage" type="file" name="image" accept="image/*" multiple />
        </div>
  <div style="display:flex; gap:.5rem; align-items:center; margin-top:.75rem;">
  <button class="btn upload-btn disabled" type="submit" disabled>Upload</button>
  <button class="btn btn-danger-solid" type="button" id="clearInputBtn" disabled>Clear</button>
  </div>
      </div>
    </div>
    <div class="main-col">
      <div class="main-section output-section">
        <h2>Image Output</h2>
        <div id="outputArea" class="image-box">
          <p id="outputPlaceholder" class="placeholder">Your processed image will appear here.</p>
          <div id="outputGrid" class="multi-preview-container output-grid" style="display:none;"></div>
        </div>
        <!-- Shared media overlay for viewing outputs (matches Library design) -->
        <div id="outputOverlay" class="media-overlay" role="dialog" aria-modal="true" aria-label="Output media viewer">
          <button class="nav-btn prev-btn" type="button" aria-label="Previous" id="outPrev">&#10094;</button>
          <div class="media-frame" id="outputFrame">
            <button class="close-btn" type="button" aria-label="Close" id="outClose">âœ•</button>
          </div>
          <button class="nav-btn next-btn" type="button" aria-label="Next" id="outNext">&#10095;</button>
        </div>
        <div style="display:flex; gap:.5rem; align-items:center; margin-top:.75rem;">
          <a id="downloadLink" href="#" download class="disabled">
            <button class="btn download-btn" type="button" disabled>Download</button>
          </a>
          <button class="btn btn-danger-solid" type="button" id="clearOutputBtn" disabled>Clear</button>
        </div>
      </div>
    </div>
  </div>
  <div class="main-container">
    <div class="comparison-container-wrapper" id="comparisonSection" style="display:none;">
      <div class="main-col">
        <div class="main-section comparison-section">
          <h2>Comparison</h2>
          <div class="image-box">
            <p id="comparisonPlaceholder" class="placeholder">Comparison will appear here.</p>
            <div id="comparisonContainer" class="comparison-container" style="display:none;">
              <div class="comparison-before">
                <img id="comparisonBeforeImg" src="" alt="Before" />
              </div>
              <div class="comparison-after">
                <img id="comparisonAfterImg" src="" alt="After" />
              </div>
              <div class="comparison-slider"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="settings-container" id="settingsSection" style="display:none;">
      <div class="main-col">
        <div class="main-section settings-section">
          <h2>Settings</h2>
          <div class="settings-box">
            <label for="prompt" class="settings-label">Prompt</label>
            <input type="text" id="prompt" name="prompt" class="settings-input" value="Change clothes to nothing revealing realistic and detailed skin, breasts and nipples. Preserve the person in the exact same position, scale, and pose. Preserve skin color and body type. Preserve the exact same face details, shape and expression. Preserve jewelry, accessories and tattoos. If hair, hands, arms, elbows, feet, legs, knees, other body parts or other objects block the view to the breasts, nipples or vagina, move them out of the way. If the breasts or vagina is not visible, turn the woman around or move the camera so the breasts and vagina are visible." />
            <div class="settings-row">
              <div class="settings-item">
                <label for="steps" class="settings-label">Steps</label>
                <input type="range" id="steps" name="steps" class="settings-input" value="20" min="1" max="100" step="1" oninput="document.getElementById('stepsValue').textContent = this.value" />
                <span id="stepsValue">20</span>
              </div>
              <div class="settings-item">
                <label for="outputHeight" class="settings-label">Output Height</label>
                <select id="outputHeight" name="outputHeight" class="settings-input">
                  <option value="480">480p (SD)</option>
                  <option value="720">720p (HD)</option>
                  <option value="1080" selected>1080p (Full HD)</option>
                  <option value="1440">1440p (2K)</option>
                  <option value="2160">2160p (4K)</option>
                  <option value="512">512px (Square)</option>
                  <option value="768">768px (Square)</option>
                  <option value="1024">1024px (Square)</option>
                  <option value="1536">1536px (Square)</option>
                  <option value="2048">2048px (Square)</option>
                  <option value="854">854px (Portrait SD)</option>
                  <option value="1280">1280px (Portrait HD)</option>
                  <option value="1920">1920px (Portrait FHD)</option>
                  <option value="2560">2560px (Portrait 2K)</option>
                  <option value="3840">3840px (Portrait 4K)</option>
                  <option value="896">896px (9:16 Portrait)</option>
                  <option value="1152">1152px (9:16 HD)</option>
                  <option value="1344">1344px (Tall Portrait)</option>
                  <option value="1600">1600px (Portrait XL)</option>
                </select>
              </div>
            </div>
            <fieldset class="lora-fieldset">
              <legend>LoRA Settings</legend>
              <div class="lora-grid" id="loraGrid"></div>
              <div class="lora-controls">
                <button type="button" id="addLoraBtn" class="btn lora-add-btn">+ Add LoRA</button>
              </div>
            </fieldset>
            <!-- CAPTCHA removed -->
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
<!-- Advanced mode visibility now controlled via header checkbox -->
<%- include('partials/navbar', { active: 'generator' }) %>
