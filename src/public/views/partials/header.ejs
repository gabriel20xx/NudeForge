<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= (typeof siteTitle !== 'undefined' ? siteTitle : 'NudeForge') %> - <%= title %></title>
  <!-- Load core theme tokens first to avoid flash, then component styles -->
  <link rel="stylesheet" href="/assets/theme.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script>
    // Early theme set (runs before paint). Keeps in sync with storage key used below.
    (function(){
      try {
        var key='app-theme-preference';
        var stored = localStorage.getItem(key);
        var root = document.documentElement;
        if(stored){
          root.setAttribute('data-theme', stored);
        } else {
          // Respect system preference on first load
          var prefersLight = matchMedia('(prefers-color-scheme: light)').matches;
          root.setAttribute('data-theme', prefersLight ? 'light' : 'dark');
        }
      } catch(e) { /* no-op */ }
    })();
  </script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="body-container">
  <!-- Toast / notification stack (shared) -->
  <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="false"></div>
    <header class="app-topbar" role="banner">
  <a href="/" class="app-logo" aria-label="Go to home"><%= (typeof siteTitle !== 'undefined' ? siteTitle : 'NudeForge') %></a>
      <div class="app-topbar-center">
        <div class="processing-stats">
          <span id="unifiedStatusDisplay" class="stat-line">
            <span id="processingStatus">Idle</span>
            <span id="progressPct" class="progress-pct"></span>
            <span id="queueMeta" class="queue-meta" style="display:none;"></span>
          </span>
        </div>
      </div>
      <div class="app-topbar-right">
        <div class="header-options">
          <label class="header-option-label">
            <input type="checkbox" id="advancedModeToggle" class="header-option-checkbox" />
            Advanced
          </label>
            <% if (typeof showLibraryModeToggle !== 'undefined' && showLibraryModeToggle) { %>
            <label class="header-option-label" style="gap:.35rem;">
              <span>Source:</span>
              <select id="libraryMode" class="ui-select" style="height:28px; padding:.2rem .6rem;">
                <option value="local">This browser</option>
                <option value="api">Server (API)</option>
              </select>
            </label>
            <% } %>
        </div>
        <div class="theme-toggle">
          <button type="button" id="themeToggleBtn" class="theme-toggle-btn" aria-label="Toggle theme" title="Toggle dark / light theme">ðŸŒ™</button>
        </div>
      </div>
  </header>
