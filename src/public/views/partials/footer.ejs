  <script>
    // Theme toggle (post-load). Early theme applied in header; here we just wire interactions.
    (function(){
      const storageKey='app-theme-preference';
      const root=document.documentElement;
      const mqDark = matchMedia('(prefers-color-scheme: dark)');
      function apply(t){ if(!t) return; root.setAttribute('data-theme', t); const btn=document.getElementById('themeToggleBtn'); if(btn) btn.textContent = t==='dark'?'🌙':'☀️'; }
      function toggle(){ const cur = root.getAttribute('data-theme')||'dark'; const next = cur==='dark'?'light':'dark'; try{ localStorage.setItem(storageKey,next);}catch(_e){} apply(next); }
      document.addEventListener('DOMContentLoaded', function(){
        // Sync button icon with current state
        apply(root.getAttribute('data-theme'));
        const btn=document.getElementById('themeToggleBtn'); if(btn) btn.addEventListener('click', toggle);
      });
      // If user hasn't chosen, follow system changes
      mqDark.addEventListener('change', e=>{ try { if(!localStorage.getItem(storageKey)) apply(e.matches?'dark':'light'); } catch(_e){} });
      // Listen to storage events (multi-tab)
      window.addEventListener('storage', e=>{ if(e.key===storageKey) apply(e.newValue); });
    })();
  </script>
  <script src="/shared/clientLogger.js"></script>
  <script src="/js/main.js"></script>
  </div>
</body>
</html>
